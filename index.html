
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Simulaci√≥n de consola Stata ‚Äî resultados</title>
  <style>
    :root {
      --bg: #0b0f14;
      --panel: #0f1620;
      --text: #d1e7ff;
      --muted: #6ea8fe;
      --accent: #66d9ef;
      --green: #a6e22e;
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; margin: 0; background: var(--bg); color: var(--text); font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; }
    header {
      position: sticky; top: 0; z-index: 10;
      background: linear-gradient(180deg, rgba(11,15,20,.95), rgba(11,15,20,.75));
      backdrop-filter: blur(6px);
      border-bottom: 1px solid #1b2533;
      padding: .75rem 1rem;
      display: flex; gap: .75rem; align-items: center; flex-wrap: wrap;
    }
    header .brand { font-weight: 700; letter-spacing:.5px; color: var(--green); }
    header button, header select, header input[type="range"] {
      background: var(--panel); color: var(--text); border:1px solid #1b2533; padding:.5rem .75rem; border-radius:.5rem; cursor:pointer;
    }
    header input[type="range"]{ width: 140px; }
    header .spacer { flex: 1; }
    main {
      max-width: 1100px; margin: 0 auto; padding: 1rem;
    }
    .terminal {
      background: var(--panel);
      border: 1px solid #1b2533;
      border-radius: 12px;
      padding: 1rem;
      min-height: 70vh;
      overflow: auto;
      line-height: 1.35;
      box-shadow: 0 20px 60px rgba(0,0,0,.35);
      position: relative;
    }
    .cursor {
      display: inline-block;
      width: 8px; height: 1.1em;
      background: var(--accent);
      vertical-align: -2px;
      animation: blink 1s steps(1) infinite;
      margin-left: 2px;
    }
    @keyframes blink { 50% { opacity: 0; } }
    .footer-note { color:#9fb6d1; font-size:.85rem; margin-top:.75rem; }
    .kbd { background:#152130; border:1px solid #1b2533; padding:2px 6px; border-radius:6px; }
  </style>
</head>
<body>
  <header>
    <div class="brand">stata.exe</div>
    <button id="btnPlay" title="Reproducir/Pausar">‚ñ∂Ô∏è Reproducir</button>
    <button id="btnSkip" title="Saltar animaci√≥n y mostrar todo">‚è≠Ô∏è Saltar</button>
    <button id="btnClear" title="Limpiar y reiniciar">üßπ Limpiar</button>
    <div class="controls">
      <small>Velocidad</small>
      <input id="speed" type="range" min="0" max="3" step="1" value="1">
      <select id="mode">
        <option value="type">Escritura por caracteres</option>
        <option value="line">Escritura por l√≠neas</option>
      </select>
    </div>
    <div class="spacer"></div>
    <button id="btnCopy" title="Copiar texto">üìã Copiar</button>
    <a id="btnDownload" download="stata_resultados.txt" title="Descargar texto" style="text-decoration:none;">
      ‚¨áÔ∏è Descargar
    </a>
  </header>
  <main>
    <div class="terminal" id="term" aria-live="polite" aria-label="Consola de resultados Stata">
      <pre id="out" class="output"></pre><span class="cursor" id="cursor"></span>
    </div>
    <div class="footer-note">
      Simulaci√≥n visual de consola basada en resultados exportados. Fuente: archivo PDF de salida de Stata (ver conversaci√≥n).
      Atajos: <span class="kbd">Espacio</span> reproduce/pausa ¬∑ <span class="kbd">S</span> salta ¬∑ <span class="kbd">C</span> limpia.
    </div>
  </main>

  <script>
    const TEXT = `Stata output


resultados 04.09.2025  Thursday September 4 09:00:26 2025   Page 1

                                                                          ___  ____  ____  ____  ____(R)
                                                                         /__    /   ____/   /   ____/   
                                                                        ___/   /   /___/   /   /___/    
                                                                          Statistics/Data Analysis      

                                                                            User: omar                  
                                                                         Project: rec IVA               

  ___  ____  ____  ____  ____ (R)
 /__    /   ____/   /   ____/
___/   /   /___/   /   /___/   16.0   Copyright 1985-2019 StataCorp LLC
  Statistics/Data Analysis            StataCorp
                                      4905 Lakeway Drive
     MP - Parallel Edition            College Station, Texas 77845 USA
                                      800-STATA-PC        http://www.stata.com
                                      979-696-4600        stata@stata.com
                                      979-696-4601 (fax)

Single-user 2-core Stata perpetual license:
       Serial number:  501606203204
         Licensed to:  Juan Palomino
                       Juan Palomino

Notes:
      1.  Unicode is supported; see help unicode_advice.
      2.  More than 2 billion observations are allowed; see help obs_advice.
      3.  Maximum number of variables is set to 5000; see help set_maxvar.

1 . doedit "C:\Users\omarm\OneDrive\Desktop\main-code_IVA_100-.do" 

2 . do "C:\Users\omarm\AppData\Local\Temp\STD4440_000000.tmp"

3 . // ========================================================
4 . // AN√ÅLISIS DE LA CULTURA TRIBUTARIA DE LOS CONTRIBUYENTES EN R√âGIMEN GENERAL 
5 . // Y SU EFECTO EN LA RECAUDACI√ìN DEL IVA EN LA CIUDAD DE LA PAZ
6 . // Modelo MCO de an√°lisis de cultura tributaria
7 . // Autor: Omar Joel Mendez Condori ‚Äì Tesis de Grado
8 . // Fecha: 04-08-2025
9 . // ========================================================

10 . 
11 . 
12 . ********************************************************************************
13 . * 1. IMPORTACI√ìN Y CONFIGURACI√ìN DE LA SERIE TEMPORAL
14 . ********************************************************************************
15 . 
16 . * 1.1 Importar base de datos desde archivo Excel
17 . import excel "C:\Users\omarm\OneDrive\Desktop\nuevos_datos.xlsx", sheet("Hoja1") firstrow clear

(16 vars, 37 obs)

18 . 
19 . * 1.2 Crear variable de fecha mensual y declarar estructura de serie de tiempo
20 . gen date = monthly(fecha, "YM")

(1 missing value generated)

21 . format date %tm

22 . tsset date
        time variable:  date, 2022m1 to 2024m12
                delta:  1 month

23 . 
24 . //Estacionariedad



resultados 04.09.2025  Thursday September 4 09:00:26 2025   Page 2

25 . dfuller r_total

Dickey-Fuller test for unit root                   Number of obs   =        35

                                Interpolated Dickey-Fuller 
                  Test         1% Critical       5% Critical      10% Critical
               Statistic           Value             Value             Value

 Z(t)             -3.246            -3.682            -2.972            -2.618

MacKinnon approximate p-value for Z(t) = 0.0175

26 . dfuller infoquizzes

Dickey-Fuller test for unit root                   Number of obs   =        35

                                Interpolated Dickey-Fuller 
                  Test         1% Critical       5% Critical      10% Critical
               Statistic           Value             Value             Value

 Z(t)             -5.081            -3.682            -2.972            -2.618

MacKinnon approximate p-value for Z(t) = 0.0000

27 . dfuller plazos_coercitivos

Dickey-Fuller test for unit root                   Number of obs   =        35

                                Interpolated Dickey-Fuller 
                  Test         1% Critical       5% Critical      10% Critical
               Statistic           Value             Value             Value

 Z(t)             -4.648            -3.682            -2.972            -2.618

MacKinnon approximate p-value for Z(t) = 0.0001

28 . dfuller IGAE

Dickey-Fuller test for unit root                   Number of obs   =        35

                                Interpolated Dickey-Fuller 
                  Test         1% Critical       5% Critical      10% Critical
               Statistic           Value             Value             Value

 Z(t)             -3.678            -3.682            -2.972            -2.618

MacKinnon approximate p-value for Z(t) = 0.0044

29 . 
30 . ********************************************************************************
31 . * 2. MODELO EN NIVELES: ESTIMACI√ìN, DIAGN√ìSTICO Y CORRECCI√ìN
32 . ********************************************************************************
33 . 
34 . * 2.1 Estimaci√≥n por MCO en niveles (sin logaritmos)
35 . reg r_total L(5).infoquizzes plazos_coercitivos L(1).IGAE

      Source        SS           df       MS      Number of obs   =        31
   F(3, 27)        =     15.76

       Model   3.1951e+16         3  1.0650e+16   Prob > F        =    0.0000
    Residual   1.8241e+16        27  6.7559e+14   R-squared       =    0.6366

   Adj R-squared   =    0.5962
       Total   5.0191e+16        30  1.6730e+15   Root MSE        =    2.6e+07



resultados 04.09.2025  Thursday September 4 09:00:27 2025   Page 3

           r_total       Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]

       infoquizzes 
               L5.     2492415   663980.3     3.75   0.001      1130040     3854790
                   
plazos_coercitivos     1083852   484657.5     2.24   0.034     89417.21     2078287
                   
              IGAE 
               L1.     1271628   291449.6     4.36   0.000     673622.7     1869633
                   
             _cons   -1.91e+08   9.56e+07    -2.00   0.056    -3.87e+08     5244348

36 . 
37 . * 2.2 Evaluaci√≥n de normalidad de los residuos (Shapiro-Wilk y histograma)
38 . predict u_hat, resid

(6 missing values generated)

39 . swilk u_hat

                   Shapiro-Wilk W test for normal data

    Variable         Obs       W           V         z       Prob>z

       u_hat          31    0.98409      0.518    -1.362    0.91345

40 . histogram u_hat, normal
(bin=5, start=-53037076, width=22881446)

41 . 
42 . * 2.3 Diagn√≥stico de supuestos cl√°sicos del modelo
43 . vif                          // Comprobar multicolinealidad con VIF

    Variable        VIF       1/VIF  

        IGAE 
         L1.       1.36    0.736725
plazos_coe~s       1.30    0.768163
 infoquizzes 
         L5.       1.07    0.938486

    Mean VIF       1.24

44 . hettest                      // Prueba de heterocedasticidad de Breusch-Pagan

Breusch-Pagan / Cook-Weisberg test for heteroskedasticity 
         Ho: Constant variance
         Variables: fitted values of r_total

         chi2(1)      =     2.45
         Prob > chi2  =   0.1175

45 . estat dwatson                // Prueba de autocorrelaci√≥n (Durbin-Watson)

Durbin-Watson d-statistic(  4,    31) =  1.444624



resultados 04.09.2025  Thursday September 4 09:00:27 2025   Page 4

46 . estat bgodfrey               // Autocorrelaci√≥n de orden superior (Breusch-Godfrey)

Breusch-Godfrey LM test for autocorrelation

    lags(p)            chi2               df                 Prob > chi2

       1               2.344               1                   0.1258

                        H0: no serial correlation

47 . estat ovtest                 // Prueba RESET de variables omitidas

Ramsey RESET test using powers of the fitted values of r_total
       Ho:  model has no omitted variables
                  F(3, 24) =      1.85
                  Prob > F =      0.1646

48 . estat ic                     // Criterios de informaci√≥n (AIC y BIC)

Akaike's information criterion and Bayesian information criterion

       Model           N   ll(null)  ll(model)      df        AIC        BIC

           .          31  -586.8069  -571.1181       4   1150.236   1155.972

Note: BIC uses N = number of observations. See [R] BIC note.

49 . 
50 . * 2.4 Correcci√≥n de autocorrelaci√≥n AR(5) con Newey
51 . newey r_total L(5).infoquizzes plazos_coercitivos L(1).IGAE, lag(5)

Regression with Newey-West standard errors      Number of obs     =         31
maximum lag: 5                                  F(  3,        27) =      14.61
                                                Prob > F          =     0.0000

                                Newey-West
           r_total       Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]

       infoquizzes 
               L5.     2492415   520990.2     4.78   0.000      1423432     3561399
                   
plazos_coercitivos     1083852   491848.6     2.20   0.036      74662.3     2093042
                   
              IGAE 
               L1.     1271628   246082.7     5.17   0.000       766708     1776548
                   
             _cons   -1.91e+08   8.56e+07    -2.23   0.034    -3.66e+08   -1.53e+07

52 . 
53 . * 2.5 Reevaluaci√≥n de normalidad de residuos tras correcci√≥n
54 . drop u_hat



resultados 04.09.2025  Thursday September 4 09:00:27 2025   Page 5

55 . predict u_hat, resid
(6 missing values generated)

56 . swilk u_hat

                   Shapiro-Wilk W test for normal data

    Variable         Obs       W           V         z       Prob>z

       u_hat          31    0.98409      0.518    -1.362    0.91345

57 . histogram u_hat, normal
(bin=5, start=-53037076, width=22881446)

58 . ********************************************************************************
59 . * 2.6 TEST DE ENDOGENEIDAD (Durbin‚ÄìWu‚ÄìHausman) EN NIVELES
60 . *    Sospechosa: plazos_coercitivos
61 . *    Instrumentos: rezagos profundos de la propia variable (L(2/12))
62 . ********************************************************************************
63 . 
64 . * IV/2SLS: misma especificaci√≥n estructural que tu OLS
65 . ivregress 2sls r_total L(5).infoquizzes L(1).IGAE ///

>     (plazos_coercitivos = L(2/12).plazos_coercitivos), vce(robust)

Instrumental variables (2SLS) regression          Number of obs   =         24
                                                  Wald chi2(3)    =      39.64
                                                  Prob > chi2     =     0.0000
                                                  R-squared       =     0.6404
                                                  Root MSE        =     2.5e+07

                                  Robust
           r_total       Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]

plazos_coercitivos    530916.1   617564.7     0.86   0.390    -679488.4     1741321
                   
       infoquizzes 
               L5.     2919163   612698.8     4.76   0.000      1718295     4120031
                   
              IGAE 
               L1.     1581948   407795.2     3.88   0.000     782684.2     2381212
                   
             _cons   -2.87e+08   1.26e+08    -2.28   0.023    -5.33e+08   -4.01e+07

Instrumented:  plazos_coercitivos
Instruments:   L5.infoquizzes L.IGAE L2.plazos_coercitivos L3.plazos_coercitivos
               L4.plazos_coercitivos L5.plazos_coercitivos L6.plazos_coercitivos
               L7.plazos_coercitivos L8.plazos_coercitivos L9.plazos_coercitivos
               L10.plazos_coercitivos L11.plazos_coercitivos
               L12.plazos_coercitivos

66 . 
67 . * Diagn√≥sticos clave
68 . estat firststage     // Relevancia de instrumentos (F de primera etapa)

  First-stage regression summary statistics
  
                           Adjusted      Partial       Robust
      Variable    R-sq.       R-sq.        R-sq.      F(11,10)   Prob > F
  
  plazos_coe~s   0.5772      0.0276       0.4432       1.21184    0.3848
  



resultados 04.09.2025  Thursday September 4 09:00:27 2025   Page 6

69 . estat overid         // Validez conjunta (si hay sobreidentificaci√≥n)

  Test of overidentifying restrictions:

  Score chi2(10)         =  11.7217  (p = 0.3041)

70 . estat endogenous     // Durbin y Wu‚ÄìHausman: ¬øplazos_coercitivos es end√≥geno?

  Tests of endogeneity
  Ho: variables are exogenous

  Robust score chi2(1)            =  1.68907  (p = 0.1937)
  Robust regression F(1,19)       =  1.83433  (p = 0.1915)

71 . 
72 . * (OPCIONAL) Si tambi√©n quieres testear L(5).infoquizzes:
73 . ivregress 2sls r_total plazos_coercitivos L(1).IGAE ///

>     (L(5).infoquizzes = L(6/12).infoquizzes), vce(robust)

Instrumental variables (2SLS) regression          Number of obs   =         24
                                                  Wald chi2(3)    =      61.94
                                                  Prob > chi2     =     0.0000
                                                  R-squared       =     0.6676
                                                  Root MSE        =     2.4e+07

                                  Robust
           r_total       Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]

       infoquizzes 
               L5.     3370303   743360.4     4.53   0.000      1913343     4827262
                   
plazos_coercitivos     1280536   521862.6     2.45   0.014     257704.6     2303368
                   
              IGAE 
               L1.     1438858   385501.1     3.73   0.000     683290.3     2194427
                   
             _cons   -2.76e+08   1.23e+08    -2.23   0.026    -5.18e+08   -3.35e+07

Instrumented:  L5.infoquizzes
Instruments:   plazos_coercitivos L.IGAE L6.infoquizzes L7.infoquizzes
               L8.infoquizzes L9.infoquizzes L10.infoquizzes L11.infoquizzes
               L12.infoquizzes

74 . 
75 . estat firststage

  First-stage regression summary statistics
  
                           Adjusted      Partial       Robust
      Variable    R-sq.       R-sq.        R-sq.       F(7,14)   Prob > F
  
  L5.infoqui~s   0.5221      0.2149       0.4335        3.3828    0.0249
  



resultados 04.09.2025  Thursday September 4 09:00:27 2025   Page 7

76 . estat overid

  Test of overidentifying restrictions:

  Score chi2(6)          =  6.29143  (p = 0.3913)

77 . estat endogenous

  Tests of endogeneity
  Ho: variables are exogenous

  Robust score chi2(1)            =  .112267  (p = 0.7376)
  Robust regression F(1,19)       =  .093312  (p = 0.7633)

78 . 
79 . 
80 . ********************************************************************************
81 . * 3. TRANSFORMACI√ìN LOGAR√çTMICA DE VARIABLES
82 . ********************************************************************************
83 . 
84 . * 3.1 Crear logaritmos naturales para especificar modelo log-log
85 . gen ln_r_total        = ln(r_total)

(1 missing value generated)

86 . gen ln_infoquizzes    = ln(infoquizzes)
(1 missing value generated)

87 . gen ln_plazos_coercitivos = ln(plazos_coercitivos)
(1 missing value generated)

88 . gen ln_IGAE           = ln(IGAE)
(1 missing value generated)

89 . 
90 . 
91 . ********************************************************************************
92 . * 4. MODELO LOG-LOG: ESTIMACI√ìN Y DIAGN√ìSTICO
93 . ********************************************************************************
94 . 
95 . * 4.1 Estimaci√≥n por MCO con variables logar√≠tmicas (modelo log-log)
96 . reg ln_r_total L(5).ln_infoquizzes L(1).ln_IGAE

      Source        SS           df       MS      Number of obs   =        31
   F(2, 28)        =     18.82

       Model   .250933346         2  .125466673   Prob > F        =    0.0000
    Residual   .186663364        28  .006666549   R-squared       =    0.5734

   Adj R-squared   =    0.5430
       Total   .437596709        30  .014586557   Root MSE        =    .08165

    ln_r_total       Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]

ln_infoquizzes 
           L5.    .2047992    .057469     3.56   0.001     .0870792    .3225192
               
       ln_IGAE 
           L1.    1.541145   .2685658     5.74   0.000      .991013    2.091277
               
         _cons    10.00141   1.613619     6.20   0.000     6.696062    13.30676



resultados 04.09.2025  Thursday September 4 09:00:27 2025   Page 8

97 . 
98 . * 4.2 Diagn√≥stico de supuestos en modelo log-log
99 . vif                          // Multicolinealidad

    Variable        VIF       1/VIF  

     ln_IGAE 
         L1.       1.07    0.934818
ln_infoqui~s 
         L5.       1.07    0.934818

    Mean VIF       1.07

100 . hettest                      // Heterocedasticidad

Breusch-Pagan / Cook-Weisberg test for heteroskedasticity 
         Ho: Constant variance
         Variables: fitted values of ln_r_total

         chi2(1)      =     0.55
         Prob > chi2  =   0.4581

101 . estat dwatson                // Autocorrelaci√≥n (DW)

Durbin-Watson d-statistic(  3,    31) =  1.327957

102 . estat bgodfrey               // Autocorrelaci√≥n de orden superior (BG)

Breusch-Godfrey LM test for autocorrelation

    lags(p)            chi2               df                 Prob > chi2

       1               2.264               1                   0.1324

                        H0: no serial correlation

103 . estat ovtest                 // Omisi√≥n de variables

Ramsey RESET test using powers of the fitted values of ln_r_total
       Ho:  model has no omitted variables
                  F(3, 25) =      2.94
                  Prob > F =      0.0527

104 . estat ic                     // Criterios AIC y BIC

Akaike's information criterion and Bayesian information criterion

       Model           N   ll(null)  ll(model)      df        AIC        BIC

           .          31    22.0498   35.25566       3  -64.51132  -60.20936

Note: BIC uses N = number of observations. See [R] BIC note.

105 . 



resultados 04.09.2025  Thursday September 4 09:00:27 2025   Page 9

106 . ********************************************************************************
107 . * 4.3 TEST DE ENDOGENEIDAD (Durbin‚ÄìWu‚ÄìHausman) EN LOG-LOG
108 . *     Sospechosa: L(5).ln_infoquizzes
109 . *     Instrumentos: rezagos m√°s profundos L(6/12).ln_infoquizzes
110 . ********************************************************************************
111 . 
112 . ivregress 2sls ln_r_total L(1).ln_IGAE ///

>     (L(5).ln_infoquizzes = L(6/12).ln_infoquizzes), vce(robust)

Instrumental variables (2SLS) regression          Number of obs   =         24
                                                  Wald chi2(2)    =      46.97
                                                  Prob > chi2     =     0.0000
                                                  R-squared       =     0.5290
                                                  Root MSE        =     .08332

                              Robust
    ln_r_total       Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]

ln_infoquizzes 
           L5.     .375631   .0980246     3.83   0.000     .1835063    .5677557
               
       ln_IGAE 
           L1.    1.879577   .2822441     6.66   0.000     1.326389    2.432765
               
         _cons    7.484137   1.779076     4.21   0.000     3.997212    10.97106

Instrumented:  L5.ln_infoquizzes
Instruments:   L.ln_IGAE L6.ln_infoquizzes L7.ln_infoquizzes L8.ln_infoquizzes
               L9.ln_infoquizzes L10.ln_infoquizzes L11.ln_infoquizzes
               L12.ln_infoquizzes

113 . 
114 . estat firststage

  First-stage regression summary statistics
  
                           Adjusted      Partial       Robust
      Variable    R-sq.       R-sq.        R-sq.       F(7,15)   Prob > F
  
  L5.ln_info~s   0.4449      0.1488       0.3547        2.6445    0.0540
  

115 . estat overid

  Test of overidentifying restrictions:

  Score chi2(6)          =  2.46707  (p = 0.8721)

116 . estat endogenous

  Tests of endogeneity
  Ho: variables are exogenous

  Robust score chi2(1)            =   2.7973  (p = 0.0944)
  Robust regression F(1,20)       =  2.81948  (p = 0.1087)



resultados 04.09.2025  Thursday September 4 09:00:28 2025   Page 10

117 . 
118 . 
119 . ********************************************************************************
120 . * 5. MODELO LOG-LOG CON CORRECCI√ìN POR AUTOCORRELACI√ìN AR(5) con Newey
121 . ********************************************************************************
122 . 
123 . * 5.1 Estimaci√≥n log-log con correcci√≥n Prais‚ÄìWinsten (AR1)
124 . newey ln_r_total L(5).ln_infoquizzes L(1).ln_IGAE, lag(5)

Regression with Newey-West standard errors      Number of obs     =         31
maximum lag: 5                                  F(  2,        28) =      31.27
                                                Prob > F          =     0.0000

                            Newey-West
    ln_r_total       Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]

ln_infoquizzes 
           L5.    .2047992   .0424766     4.82   0.000     .1177898    .2918086
               
       ln_IGAE 
           L1.    1.541145   .1962293     7.85   0.000     1.139188    1.943102
               
         _cons    10.00141   1.209154     8.27   0.000      7.52457    12.47825

125 . 
126 . 
127 . // --------------------------
128 . // FIN DEL C√ìDIGO
129 . // --------------------------
130 . // --------------------------
131 . // FIN DEL C√ìDIGO
132 . // --------------------------
133 . // --------------------------
134 . // FIN DEL C√ìDIGO
135 . // --------------------------
136 . 

end of do-file

137 . 
`;
    const lines = TEXT.split("\n");
    const out = document.getElementById('out');
    const cursor = document.getElementById('cursor');
    const term = document.getElementById('term');

    // State
    let playing = false;
    let lineIdx = 0;
    let charIdx = 0;
    let rafId = null;

    function scrollToBottom() { term.scrollTop = term.scrollHeight; }

    function frame() { 
      if (!playing) return;
      const speed = Number(document.getElementById('speed').value);
      const mode = document.getElementById('mode').value;
      const bursts = [1, 2, 6, 20][speed]; // chars per tick

      if (mode === 'line') {
        if (lineIdx < lines.length) {
          out.textContent += lines[lineIdx] + "\n";
          lineIdx++; 
          scrollToBottom();
          setTimeout(frame, 20); // fast per-line
        } else {
          stop();
        }
        return;
      }

      // character mode
      for (let i = 0; i < bursts; i++) {
        if (lineIdx >= lines.length) { stop(); return; }
        const line = lines[lineIdx];
        if (charIdx < line.length) { 
          out.textContent += line[charIdx++];
        } else {
          out.textContent += "\n";
          lineIdx++; charIdx = 0;
        }
      }
      scrollToBottom();
      rafId = requestAnimationFrame(frame);
    }

    function play() {
      if (playing) { pause(); return; }
      playing = true;
      document.getElementById('btnPlay').textContent = '‚è∏Ô∏è Pausar';
      frame();
    }
    function pause() {
      playing = false;
      document.getElementById('btnPlay').textContent = '‚ñ∂Ô∏è Reproducir';
      if (rafId) cancelAnimationFrame(rafId);
    }
    function stop() {
      pause();
      cursor.style.opacity = 0;
    }
    function skip() {
      pause();
      out.textContent = lines.join("\n") + "\n";
      lineIdx = lines.length; charIdx = 0;
      scrollToBottom();
      cursor.style.opacity = 0;
    }
    function clearAll() {
      pause();
      out.textContent = '';
      lineIdx = 0; charIdx = 0;
      cursor.style.opacity = 1;
      scrollToBottom();
    }
    function copyAll() {
      navigator.clipboard.writeText(out.textContent || lines.join("\n")).then(() => {
        document.getElementById('btnCopy').textContent = '‚úÖ Copiado';
        setTimeout(()=> document.getElementById('btnCopy').textContent = 'üìã Copiar', 1200);
      });
    }
    function updateDownload() {
      const blob = new Blob([lines.join("\n")], {type: 'text/plain'});
      const url = URL.createObjectURL(blob);
      const a = document.getElementById('btnDownload');
      a.href = url;
    }

    document.getElementById('btnPlay').addEventListener('click', play);
    document.getElementById('btnSkip').addEventListener('click', skip);
    document.getElementById('btnClear').addEventListener('click', clearAll);
    document.getElementById('btnCopy').addEventListener('click', copyAll);
    document.getElementById('mode').addEventListener('change', () => { /* switch mode */ });
    document.getElementById('speed').addEventListener('input', () => { /* live speed change */ });
    window.addEventListener('keydown', (e) => {
      if (e.code === 'Space') { e.preventDefault(); play(); }
      if (e.key.toLowerCase() === 's') { skip(); }
      if (e.key.toLowerCase() === 'c') { clearAll(); }
    });
    updateDownload();
  </script>
</body>
</html>
